

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial: Easy Machine Learning with Latent Variable Models in AMIDST &mdash; InferPy 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/inferpy_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Flinklink: Code Examples" href="flinklink.html" />
    <link rel="prev" title="Wekalink: using an AMIDST classifier in Weka" href="wekalink.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo-doc.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">General Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about-amidst.html">About AMIDST</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about-amidst.html#what-is-amidst">What is AMIDST?</a></li>
<li class="toctree-l2"><a class="reference internal" href="about-amidst.html#scalability">Scalability</a><ul>
<li class="toctree-l3"><a class="reference internal" href="about-amidst.html#multi-core-scalablity-using-java-8-streams">Multi-Core Scalablity using Java 8 Streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="about-amidst.html#distributed-scalablity-using-apache-flink">Distributed Scalablity using Apache Flink</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="about-amidst.html#related-software">Related Software</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="sparklink.html">Sparklink: Code Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sparklink.html#input-output">Input/output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sparklink.html#reading-data">Reading data</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparklink.html#writing-data">Writing data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sparklink.html#parameter-learning">Parameter learning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wekalink.html">Wekalink: using an AMIDST classifier in Weka</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wekalink.html#prepare-your-project">Prepare your project</a></li>
<li class="toctree-l2"><a class="reference internal" href="wekalink.html#create-the-wrapper-class">Create the wrapper class</a></li>
<li class="toctree-l2"><a class="reference internal" href="wekalink.html#testing-the-amidst-classifier-in-weka">Testing the AMIDST classifier in Weka</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial: Easy Machine Learning with Latent Variable Models in AMIDST</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up">Setting up</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-models">Static Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#learning-and-saving-to-disk">Learning and saving to disk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#learning-from-flink">Learning from Flink</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inference">Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-static-model">Custom static model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-models">Dynamic Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-dynamic-model">Custom dynamic model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="flinklink.html">Flinklink: Code Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="flinklink.html#input-output">Input/output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flinklink.html#reading-data">Reading data</a></li>
<li class="toctree-l3"><a class="reference internal" href="flinklink.html#writing-data">Writing data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flinklink.html#parametric-learning">Parametric learning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flinklink.html#parallel-maximum-likelihood">Parallel Maximum Likelihood</a></li>
<li class="toctree-l3"><a class="reference internal" href="flinklink.html#distributed-variational-message-passing">Distributed Variational Message Passing</a></li>
<li class="toctree-l3"><a class="reference internal" href="flinklink.html#distributed-vi">Distributed VI</a></li>
<li class="toctree-l3"><a class="reference internal" href="flinklink.html#stochastic-vi">Stochastic VI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flinklink.html#extensions-and-applications">Extensions and applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flinklink.html#latent-variable-models-with-flink">Latent variable models with Flink</a></li>
<li class="toctree-l3"><a class="reference internal" href="flinklink.html#concept-drift-detection">Concept drift detection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dbnetworks.html">Dynamic Bayesian Networks: Code Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dbnetworks.html#data-streams">Data Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="dbnetworks.html#dynamic-random-variables">Dynamic Random Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="dbnetworks.html#dynamic-bayesian-networks">Dynamic Bayesian networks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dbnetworks.html#creating-dynamic-bayesian-networks">Creating Dynamic Bayesian networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbnetworks.html#creating-dynamic-bayesian-networks-with-latent-variables">Creating Dynamic Bayesian Networks with Latent Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbnetworks.html#modifying-dynamic-bayesian-networks">Modifying Dynamic Bayesian Networks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dbnetworks.html#sampling-from-dynamic-bayesian-networks">Sampling from Dynamic Bayesian Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="dbnetworks.html#inference-algorithms-for-dynamic-bayesian-networks">Inference Algorithms for Dynamic Bayesian Networks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dbnetworks.html#the-dynamic-map-inference">The Dynamic MAP Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbnetworks.html#the-dynamic-variational-message-passing">The Dynamic Variational Message Passing</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbnetworks.html#the-dynamic-importance-sampling">The Dynamic Importance Sampling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dbnetworks.html#dynamic-learning-algorithms">Dynamic Learning Algorithms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dbnetworks.html#maximum-likelihood-for-dbns">Maximum Likelihood for DBNs</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbnetworks.html#streaming-variational-bayes-for-dbns">Streaming Variational Bayes for DBNs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bnetworks.html">Bayesian Networks: Code Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bnetworks.html#data-streams">Data Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="bnetworks.html#sec-bns-randomvars">Data Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="bnetworks.html#models">Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#creating-bns">Creating BNs</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#creating-bayesian-networks-with-latent-variables">Creating Bayesian networks with latent variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#modifiying-bayesian-networks">Modifiying Bayesian networks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bnetworks.html#input-output">Input/Output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#i-o-of-data-streams">I/O of data streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#i-o-of-bns">I/O of BNs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bnetworks.html#inference">Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#the-inference-engine">The inference engine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bnetworks.html#id2">Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#variational-message-passing">Variational Message Passing</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#importance-sampling">Importance Sampling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bnetworks.html#learning-algorithms">Learning Algorithms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#maximum-likelihood">Maximum Likelihood</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#parallel-maximum-likelihood">Parallel Maximum Likelihood</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#streaming-variational-bayes">Streaming Variational Bayes</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#parallel-streaming-variational-bayes">Parallel Streaming Variational Bayes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bnetworks.html#concept-drift-methods">Concept Drift Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#naive-bayes-with-virtual-concept-drift-detection">Naive Bayes with Virtual Concept Drift Detection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bnetworks.html#huginlink">HuginLink</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#models-conversion-between-amidst-and-hugin">Models conversion between AMiDST and Hugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#i-o-of-bayesian-networks-with-hugin-net-format">I/O of Bayesian Networks with Hugin net format</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#invoking-hugins-inference-engine">Invoking Hugin’s inference engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#invoking-hugins-parallel-tan">Invoking Hugin’s Parallel TAN</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bnetworks.html#moalink">MoaLink</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#amidst-classifiers-from-moa">AMIDST Classifiers from MOA</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnetworks.html#sec-bns-moalink-moareg">AMIDST Classifiers from MOA</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">First steps</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started!</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#quick-start">Quick start</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#getting-started-in-detail">Getting started in detail</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements for AMIDST Toolbox</a><ul>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#for-toolbox-users">For toolbox users</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#for-amidst-developers">For AMIDST developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="loading-dependencies.html">Loading AMIDST dependencies from a remote maven repository</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial: Easy Machine Learning with Latent Variable Models in AMIDST</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up">Setting up</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-models">Static Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#learning-and-saving-to-disk">Learning and saving to disk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#learning-from-flink">Learning from Flink</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inference">Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-static-model">Custom static model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-models">Dynamic Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-dynamic-model">Custom dynamic model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installing-local-repository.html">Installing a local AMIDST repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating-packages.html">Generating the packages for each module and for its dependencies</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing to AMIDST</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic-steps-contributing.html">Basic steps for contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="basic-steps-contributing.html#clone-the-repository">Clone the repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic-steps-contributing.html#create-a-new-branch-from-develop">Create a new branch from develop</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic-steps-contributing.html#modify-the-code-and-upload-your-changes">Modify the code and upload your changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic-steps-contributing.html#merge-the-new-branch-with-develop">Merge the new branch with develop</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">InferPy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Tutorial: Easy Machine Learning with Latent Variable Models in AMIDST</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/notes/latent-variable-models.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial-easy-machine-learning-with-latent-variable-models-in-amidst">
<span id="sec-lvmodels"></span><h1>Tutorial: Easy Machine Learning with Latent Variable Models in AMIDST<a class="headerlink" href="#tutorial-easy-machine-learning-with-latent-variable-models-in-amidst" title="Permalink to this headline">¶</a></h1>
<p>In AMIDST toolbox 0.4.2 the module <em>latent-variable-models</em>, that
contains a wide range of predefined latent variable models (see table
below), was included. In this tutorial we will show how the use of this
module simplifies the learning and inference processes. In fact, you
will be able to learn your model and to perform inference with a few
lines of code.</p>
<div class="figure" id="fig-lvmodels-amidstmodels">
<a class="reference internal image-reference" href="notes/img/amidstModels.png"><img alt="Set of predefined latent variable models in AMIDST" src="notes/img/amidstModels.png" style="width: 13cm;" /></a>
<p class="caption"><span class="caption-text">Set of predefined latent variable models in AMIDST</span></p>
</div>
<p>Besides of the simplicity, the required code for learning a latent
variable model is also flexible: you will be able to change the learnt
model or the inference algorithm just with some slight modfications in
the code. Another advantage of using AMIDST for learning one of the
predefined models is that the procedure is traparent to the format of
your training data: you will use the same methods regardless of learning
from a local or a distributed dataset (with Flink). Note that this last
feature was included in the version 0.5.0 of the toolbox.</p>
<div class="section" id="setting-up">
<h2>Setting up<a class="headerlink" href="#setting-up" title="Permalink to this headline">¶</a></h2>
<p>In order to follow this tutorial, you will need to have the java 8 (i.e.
SDK 1.8 or higher) installed in your system. For more details about the
system requirements, see this
<a class="reference external" href="../GettingStarted/requirements.html">link</a>. Additionally, you can
download a ready-to-use IntelliJ maven project with all the code
examples in this tutorial. For that, use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/amidst/tutorial.git
</pre></div>
</div>
<p>Alternativelly, you would rather create a new maven project or use an
existing one. For that, you might check the <a class="reference external" href="../GettingStarted/index.html">Getting
Started</a> page.</p>
<p>Note that this project does not contain any AMIDST source or binary, it
only has some .java files using the AMIDST functionallity. Instead, each
of the AMIDST modules are provided through maven. Doing that, the
transitive dependences of the AMIDST toolbox are also downloaded in a
transparent way for the user. An scheme of this idea is shown below:</p>
<div class="figure" id="fig-lvmodels-overview">
<a class="reference internal image-reference" href="notes/img/overview.png"><img alt="Set of predefined latent variable models in AMIDST" src="notes/img/overview.png" style="width: 13cm;" /></a>
<p class="caption"><span class="caption-text">Set of predefined latent variable models in AMIDST</span></p>
</div>
<p>If we open the downloaded project, we will see that it contains the
following relevant folders and files:</p>
<ul class="simple">
<li><strong>datasets</strong>: folder with local and distributed datasets used in this
tutorial in ARFF format.</li>
<li><strong>doc</strong>: folder containing documentation about this tutorial.</li>
<li><strong>lib</strong>: folder for storing those libraries not available through
maven.</li>
<li><strong>src/main/java</strong>: folder with all the code example.</li>
<li><strong>pom.xml</strong>: this is the maven configuration file where the AMIDST
dependencies are defined.</li>
</ul>
<p>In the pom.xml file of the downloaded project, only the module called
<em>latent-variable-models</em> is linked. However some other AMIDST are also
loaded as <em>latent-variable-models</em> module depends on them. This is the
case of the modules called <em>core</em>, <em>core-dynamic</em>, <em>flinklink</em>, etc. You
can see the full list of dependencies in the <strong>maven project panel</strong>,
usually located on the right side of the window (see image below). If
dependencies are not automatically downloaded, click on <strong>Upload</strong>
button. It is recommended to download the sources and java</p>
<div class="figure" id="fig-lvmodels-mavenpanel">
<a class="reference internal image-reference" href="notes/img/mavenpanel.png"><img alt="Maven project panel showing the list of dependencies" src="notes/img/mavenpanel.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-text">Maven project panel showing the list of dependencies</span></p>
</div>
</div>
<div class="section" id="static-models">
<span id="sec-lvmodels-static"></span><h2>Static Models<a class="headerlink" href="#static-models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="learning-and-saving-to-disk">
<span id="sec-lvmodels-static-learning"></span><h3>Learning and saving to disk<a class="headerlink" href="#learning-and-saving-to-disk" title="Permalink to this headline">¶</a></h3>
<p>Here we will see how can we learnt a static model from a local dataset
(non-distributed). In particular, we will use the financial-like dataset
<strong>datasets/simulated/cajamar.arff</strong> containing 4 continuous (normal
distributed) variables. From this data, a <em>Factor Analysis</em> model will
be learnt. In short, this model aims to reduce the dimensionality of a
set of observed continuous variables by expressing them as combination
of gaussians. A synthesis of this process is shown in the image below
where: <span class="math notranslate nohighlight">\(X1, X2, X3\)</span> and <span class="math notranslate nohighlight">\(X4\)</span> are the observed variables and
<span class="math notranslate nohighlight">\(H1, H2\)</span> and <span class="math notranslate nohighlight">\(H3\)</span> are the latent variables representing the
combination of gaussians.</p>
<div class="figure" id="fig-lvmodels-static-learning-scheme">
<a class="reference internal image-reference" href="notes/img/staticlearning.png"><img alt="Static learning process" src="notes/img/staticlearning.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-text">Static learning process</span></p>
</div>
<p>Note that the required functionality for learning the predefined model
is provided by the module <em>latent-variable-models</em>. A code-example for
learning a factor analysis model is shown below.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">eu.amidst.tutorial.usingAmidst.examples</span><span class="o">;</span>



<span class="kn">import</span> <span class="nn">COM.hugin.HAPI.ExceptionHugin</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.DataInstance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.DataStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.io.BayesianNetworkWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.io.DataStreamLoader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.models.BayesianNetwork</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.huginlink.io.BayesianNetworkWriterToHugin</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.FactorAnalysis</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.MixtureOfFactorAnalysers</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.Model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by rcabanas on 23/05/16.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticModelLearning</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ExceptionHugin</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>

        <span class="c1">//Load the datastream</span>
        <span class="n">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;datasets/simulated/cajamar.arff&quot;</span><span class="o">;</span>
        <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">DataInstance</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">DataStreamLoader</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">filename</span><span class="o">);</span>

        <span class="c1">//Learn the model</span>
        <span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FactorAnalysis</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">());</span>
       <span class="c1">// ((MixtureOfFactorAnalysers)model).setNumberOfLatentVariables(3);</span>

        <span class="n">model</span><span class="o">.</span><span class="na">updateModel</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="n">BayesianNetwork</span> <span class="n">bn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">getModel</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bn</span><span class="o">);</span>

        <span class="c1">// Save with .bn format</span>
        <span class="n">BayesianNetworkWriter</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bn</span><span class="o">,</span> <span class="s">&quot;networks/simulated/exampleBN.bn&quot;</span><span class="o">);</span>

        <span class="c1">// Save with hugin format</span>
        <span class="c1">//BayesianNetworkWriterToHugin.save(bn, &quot;networks/simulated/exampleBN.net&quot;);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/amidst/tutorial/blob/master/src/main/java/eu/amidst/tutorial/usingAmidst/examples/StaticModelLearning.java">See on
GitHub</a></p>
<p>For learning any of the available static models, we create an object of
any of the classes inheriting from the class <em>Model</em>. These classes
encapsulates all the fuctionality for learning/updating a
latent-variable model. For example, in the code above we create an
object of the class <em>FactorAnalysis</em> which is actually stored as <em>Model</em>
object. The flexibility of the toolbox is due to this hierarchical
desing: if we aim to change the model learnt from our data, we simply
have to change the constructor used (assuming that our data also fits
the constraints of the new model). For example, if we aim to learn a
mixture of factor analysers instead, we simply have to replace the line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FactorAnalysis</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getAtributes</span><span class="p">());</span>
</pre></div>
</div>
<p>by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MixtureOfFactorAnalysers</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getAtributes</span><span class="p">());</span>
</pre></div>
</div>
<p>Note that the method for learning the model, namely
<em>Model::updateMode(DataStream&lt;DataInstance&gt;)</em> will always be the same
regardless of the particular type of static model.</p>
<p>The actual learnt model is an object of the class <em>BayesianNetwork</em>
which is stored as a member variable of <em>Model</em>. Thus, for using the
network, we simply have to extract with the method <em>Model::getModel()</em>.
One of the actions we can perform with it is saving it into the local
file system. For saving it in <em>.bn</em> format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BayesianNetworkWriter</span><span class="p">::</span><span class="n">save</span><span class="p">(</span><span class="n">BayesianNetwork</span> <span class="n">bn</span><span class="p">,</span> <span class="n">String</span> <span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, and assuming that we have the hugin library available, we
can also save it in <em>.net</em> format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BayesianNetworkWriteToHuginr</span><span class="p">::</span><span class="n">save</span><span class="p">(</span><span class="n">BayesianNetwork</span> <span class="n">bn</span><span class="p">,</span> <span class="n">String</span> <span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="learning-from-flink">
<span id="sec-lvmodels-static-flinklearning"></span><h3>Learning from Flink<a class="headerlink" href="#learning-from-flink" title="Permalink to this headline">¶</a></h3>
<p>In previous section we showed how the AMIDST toolbox can be used for
learning a static model from a non-distributed dataset. In addition, you
can use the pre-defined models to process massive data sets in a
distributed computer cluster using <strong>Apache Flink</strong>. In particular, the
model can be learnt from a <em>distributed ARFF folder</em> or from a file
accesible via a HDFS url. A scheme of the learning process is shown
below.</p>
<div class="figure" id="fig-lvmodels-static-flinklearning-scheme">
<a class="reference internal image-reference" href="notes/img/distributedlearning.png"><img alt="Distributed learning process scheme" src="notes/img/distributedlearning.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-text">Distributed learning process scheme</span></p>
</div>
<p>A code example for learning from Flink is shown below. Note that it only
differs from the one in previous section in lines 25 to 33. In these
lines, the Flink session is configurated and the stream is loaded, which
is managed with an object of the class <em>DataFlink</em> (instead of
<em>DataStream</em>).</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">eu.amidst.tutorial.usingAmidst.examples</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">COM.hugin.HAPI.ExceptionHugin</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.DataInstance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.io.BayesianNetworkWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.models.BayesianNetwork</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.flinklink.core.data.DataFlink</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.flinklink.core.io.DataFlinkLoader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.FactorAnalysis</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.tutorial.usingAmidst.Main</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.api.java.ExecutionEnvironment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.configuration.Configuration</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by rcabanas on 23/05/16.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticModelFlink</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ExceptionHugin</span> <span class="o">{</span>


        <span class="c1">//Set-up Flink session.</span>
       <span class="c1">// Configuration conf = new Configuration();</span>
      <span class="c1">//  conf.setInteger(&quot;taskmanager.network.numberOfBuffers&quot;, 12000);</span>
        <span class="kd">final</span> <span class="n">ExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">ExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
        <span class="c1">//env.getConfig().disableSysoutLogging();</span>
       <span class="c1">// env.setParallelism(Main.PARALLELISM);</span>

        <span class="c1">//Load the datastream</span>
        <span class="n">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;datasets/simulated/cajamarDistributed.arff&quot;</span><span class="o">;</span>
        <span class="n">DataFlink</span><span class="o">&lt;</span><span class="n">DataInstance</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">DataFlinkLoader</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">env</span><span class="o">,</span> <span class="n">filename</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

        <span class="c1">//Learn the model</span>
        <span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FactorAnalysis</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">updateModel</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="n">BayesianNetwork</span> <span class="n">bn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">getModel</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bn</span><span class="o">);</span>

        <span class="c1">// Save with .bn format</span>
        <span class="n">BayesianNetworkWriter</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bn</span><span class="o">,</span> <span class="s">&quot;networks/simulated/exampleBN.bn&quot;</span><span class="o">);</span>

        <span class="c1">// Save with hugin format</span>
        <span class="c1">//BayesianNetworkWriterToHugin.save(bn, &quot;networks/simulated/exampleBN.net&quot;);</span>

    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/amidst/tutorial/blob/master/src/main/java/eu/amidst/tutorial/usingAmidst/examples/StaticModelFlink.java">See on
GitHub</a></p>
<p>In previous example, the distributed dataset is stored in our local file
system. Instead, we might need to load from a distributed file system.
For that, simply replace the string indicating the path. That is,
replace</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;datasets/simulated/cajamarDistributed.arff&quot;</span>
</pre></div>
</div>
<p>by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;hdfs://distributed-server/path-to-file&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="inference">
<span id="sec-lvmodels-static-inference"></span><h3>Inference<a class="headerlink" href="#inference" title="Permalink to this headline">¶</a></h3>
<p>Making probabilistic inference in BNs (a.k.a <em>belief updating</em>) consists
of the computation of the posterior probability distribution for a set
of variables of interest given some evidence over some other variables
(see image below).</p>
<div class="figure" id="fig-lvmodels-static-inference-scheme">
<a class="reference internal image-reference" href="notes/img/staticinference.png"><img alt="Learning process scheme" src="notes/img/staticinference.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-text">Learning process scheme</span></p>
</div>
<p>The inference process is the same regardless of the way we have learnt
our model: we simply have to obtain the BN learnt (stored as an object
of the class <em>BayesianNetwork</em>), set the target variables and the
evidence. As an example, let us consider the following code:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">eu.amidst.tutorial.usingAmidst.examples</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">eu.amidst.core.distribution.Distribution</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.inference.InferenceAlgorithm</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.inference.messagepassing.VMP</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.io.BayesianNetworkLoader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.models.BayesianNetwork</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.variables.Assignment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.variables.HashMapAssignment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.variables.Variable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.variables.Variables</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by rcabanas on 23/05/16.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticModelInference</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span> <span class="o">{</span>

        <span class="n">BayesianNetwork</span> <span class="n">bn</span>  <span class="o">=</span> <span class="n">BayesianNetworkLoader</span><span class="o">.</span><span class="na">loadFromFile</span><span class="o">(</span><span class="s">&quot;networks/simulated/exampleBN.bn&quot;</span><span class="o">);</span>
        <span class="n">Variables</span> <span class="n">variables</span> <span class="o">=</span> <span class="n">bn</span><span class="o">.</span><span class="na">getVariables</span><span class="o">();</span>

        <span class="c1">//Variabeles of interest</span>
        <span class="n">Variable</span> <span class="n">varTarget</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="na">getVariableByName</span><span class="o">(</span><span class="s">&quot;LatentVar1&quot;</span><span class="o">);</span>
        <span class="n">Variable</span> <span class="n">varObserved</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="c1">//we set the evidence</span>
        <span class="n">Assignment</span> <span class="n">assignment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMapAssignment</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="n">varObserved</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="na">getVariableByName</span><span class="o">(</span><span class="s">&quot;Income&quot;</span><span class="o">);</span>
        <span class="n">assignment</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">varObserved</span><span class="o">,</span><span class="mf">0.0</span><span class="o">);</span>

        <span class="c1">//we set the algorithm</span>
        <span class="n">InferenceAlgorithm</span> <span class="n">infer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VMP</span><span class="o">();</span> <span class="c1">//new HuginInference(); new ImportanceSampling();</span>
        <span class="n">infer</span><span class="o">.</span><span class="na">setModel</span><span class="o">(</span><span class="n">bn</span><span class="o">);</span>
        <span class="n">infer</span><span class="o">.</span><span class="na">setEvidence</span><span class="o">(</span><span class="n">assignment</span><span class="o">);</span>

        <span class="c1">//query</span>
        <span class="n">infer</span><span class="o">.</span><span class="na">runInference</span><span class="o">();</span>
        <span class="n">Distribution</span> <span class="n">p</span> <span class="o">=</span> <span class="n">infer</span><span class="o">.</span><span class="na">getPosterior</span><span class="o">(</span><span class="n">varTarget</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;P(LatentVar1|Income=0.0) = &quot;</span><span class="o">+</span><span class="n">p</span><span class="o">);</span>

        <span class="c1">//Or some more refined queries</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;P(0.7&lt;LatentVar1&lt;6.59 |Income=0.0) = &quot;</span> <span class="o">+</span> <span class="n">infer</span><span class="o">.</span><span class="na">getExpectedValue</span><span class="o">(</span><span class="n">varTarget</span><span class="o">,</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="mf">0.7</span> <span class="o">&lt;</span> <span class="n">v</span> <span class="o">&amp;&amp;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mf">6.59</span><span class="o">)</span> <span class="o">?</span> <span class="mf">1.0</span> <span class="o">:</span> <span class="mf">0.0</span> <span class="o">));</span>

    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/amidst/tutorial/blob/master/src/main/java/eu/amidst/tutorial/usingAmidst/examples/StaticModelInference.java">See on
GitHub</a></p>
<p>Note that the learning algorithm can be easily changed by simply
modifying line 35 where <em>VMP algorithm</em>. If we aim to use <em>Importance
Sampling algorithm</em>, replace such line with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">InferenceAlgorithm</span> <span class="n">infer</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ImportanceSampling</span><span class="p">();</span>
</pre></div>
</div>
<p>Alternatively, we can use <em>Hugin Inference algorithm</em> (assuming that we
have the corresponding libraries):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">InferenceAlgorithm</span> <span class="n">infer</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HuginInference</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-static-model">
<span id="sec-lvmodels-static-custom"></span><h3>Custom static model<a class="headerlink" href="#custom-static-model" title="Permalink to this headline">¶</a></h3>
<p>It could happend that your model of interest is not predifined. In that
case you can implement it yourself. For that purpose, create a new class
inheriting the class <em>Model</em>. Then, add the code to the constructor with
an object <em>Attributes</em> as input parameter, and the code of the method
<em>void buildDAG()</em>. This last method is called before learning process
and creates the object representing the DAG. As an example, the code
below shows how to create a custom Gaussian Mixture.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">eu.amidst.tutorial.usingAmidst.practice</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.Attributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.DataInstance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.DataStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.io.DataStreamLoader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.models.BayesianNetwork</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.models.DAG</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.variables.Variable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.variables.Variables</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.FactorAnalysis</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.exceptions.WrongConfigurationException</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by rcabanas on 23/05/16.</span>
<span class="cm"> */</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomGaussianMixture</span> <span class="kd">extends</span> <span class="n">Model</span><span class="o">{</span>

    <span class="n">Attributes</span> <span class="n">attributes</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CustomGaussianMixture</span><span class="o">(</span><span class="n">Attributes</span> <span class="n">attributes</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">WrongConfigurationException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">buildDAG</span><span class="o">()</span> <span class="o">{</span>

        <span class="cm">/** Create a set of variables from the given attributes**/</span>
        <span class="n">Variables</span> <span class="n">variables</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Variables</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>

        <span class="cm">/** Create a hidden variable with two hidden states*/</span>
        <span class="n">Variable</span> <span class="n">hiddenVar</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="na">newMultinomialVariable</span><span class="o">(</span><span class="s">&quot;HiddenVar&quot;</span><span class="o">,</span><span class="mi">2</span><span class="o">);</span>

        <span class="c1">//We create a standard naive Bayes</span>
        <span class="n">DAG</span> <span class="n">dag</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DAG</span><span class="o">(</span><span class="n">variables</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">Variable</span> <span class="n">variable</span><span class="o">:</span> <span class="n">variables</span><span class="o">){</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">variable</span><span class="o">==</span><span class="n">hiddenVar</span><span class="o">)</span>
                <span class="k">continue</span><span class="o">;</span>

            <span class="n">dag</span><span class="o">.</span><span class="na">getParentSet</span><span class="o">(</span><span class="n">variable</span><span class="o">).</span><span class="na">addParent</span><span class="o">(</span><span class="n">hiddenVar</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">//This is needed to maintain coherence in the Model class.</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dag</span><span class="o">=</span><span class="n">dag</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">vars</span> <span class="o">=</span> <span class="n">variables</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="c1">//Method for testing the custom model</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;datasets/simulated/cajamar.arff&quot;</span><span class="o">;</span>
        <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">DataInstance</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">DataStreamLoader</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">filename</span><span class="o">);</span>

        <span class="c1">//Learn the model</span>
        <span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CustomGaussianMixture</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">());</span>

        <span class="n">model</span><span class="o">.</span><span class="na">updateModel</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="n">BayesianNetwork</span> <span class="n">bn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">getModel</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bn</span><span class="o">);</span>
    <span class="o">}</span>


<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/amidst/tutorial/blob/master/src/main/java/eu/amidst/tutorial/usingAmidst/practice/CustomGaussianMixture.java">See on
GitHub</a></p>
</div>
</div>
<div class="section" id="dynamic-models">
<span id="sec-lvmodels-dynamic"></span><h2>Dynamic Models<a class="headerlink" href="#dynamic-models" title="Permalink to this headline">¶</a></h2>
<blockquote id="sec-lvmodels-dynamic-learning">
<div>Learning and saving to disk</div></blockquote>
<hr class="docutils" />
<p>When dealing with temporal data, it might be advisable to learn a
dynamic model. The module <em>latent-variable-models</em> in AMDIST also
suports such kinds of models. For that the classes inheriting
<em>DynamicModel</em> will be used. A synthesis of the learning process is
shown below.</p>
<div class="figure" id="fig-lvmodels-dynamic-learning-scheme">
<a class="reference internal image-reference" href="notes/img/dynamicLearning.png"><img alt="Learning process scheme of a dynamic model" src="notes/img/dynamicLearning.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-text">Learning process scheme of a dynamic model</span></p>
</div>
<p>A code-example is given below. Here, a <em>Hidden Markov Model (HMM)</em> is
learnt from a financial dataset with temporal information. Note the
difference within the static learning is the way the dataset is loaded:
now, it is handled with an object of the class
<em>DataStream&lt;DynamicDataInstance&gt;</em>. Finally, the DBN learnt is saved to
disk with the method <em>DynamicBayesianNetworkWriter::save(String
pathFile)</em>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">eu.amidst.tutorial.usingAmidst.examples</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">COM.hugin.HAPI.ExceptionHugin</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.DataStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.datastream.DynamicDataInstance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.io.DynamicBayesianNetworkWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.io.DynamicDataStreamLoader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.models.DynamicBayesianNetwork</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.dynamicmodels.DynamicModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.dynamicmodels.HiddenMarkovModel</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by rcabanas on 23/05/16.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DynamicModelLearning</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ExceptionHugin</span> <span class="o">{</span>

        <span class="c1">//Load the datastream</span>
        <span class="n">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;datasets/simulated/cajamar.arff&quot;</span><span class="o">;</span>
        <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">DynamicDataInstance</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">DynamicDataStreamLoader</span><span class="o">.</span><span class="na">loadFromFile</span><span class="o">(</span><span class="n">filename</span><span class="o">);</span>


        <span class="c1">//Learn the model</span>
        <span class="n">DynamicModel</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HiddenMarkovModel</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">updateModel</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="n">DynamicBayesianNetwork</span> <span class="n">dbn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">getModel</span><span class="o">();</span>


        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dbn</span><span class="o">);</span>


        <span class="c1">// Save with .bn format</span>
        <span class="n">DynamicBayesianNetworkWriter</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">dbn</span><span class="o">,</span> <span class="s">&quot;networks/simulated/exampleDBN.dbn&quot;</span><span class="o">);</span>

        <span class="c1">// Save with hugin format</span>
        <span class="c1">//DynamicBayesianNetworkWriterToHugin.save(dbn, &quot;networks/simulated/exampleDBN.net&quot;);</span>

    <span class="o">}</span>


<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/amidst/tutorial/blob/master/src/main/java/eu/amidst/tutorial/usingAmidst/examples/DynamicModelLearning.java">See on
GitHub</a></p>
<div class="section" id="id1">
<h3>Inference<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>In the following code-example, the inference process of dynamic models
is illustrated. First, a DBN is loaded from disk (line 24). Then, a
dynamic dataset is loaded for testing our model (lines 29 to 30). Then
the inference algorithm and target variables are set. In the final loop,
the inference is perform for each data instance.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">eu.amidst.tutorial.usingAmidst.examples</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.DataStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.distribution.UnivariateDistribution</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.inference.ImportanceSampling</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.variables.Variable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.datastream.DynamicDataInstance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.inference.FactoredFrontierForDBN</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.inference.InferenceAlgorithmForDBN</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.io.DynamicBayesianNetworkLoader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.io.DynamicDataStreamLoader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.models.DynamicBayesianNetwork</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by rcabanas on 23/05/16.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DynamicModelInference</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span> <span class="o">{</span>

        <span class="n">DynamicBayesianNetwork</span> <span class="n">dbn</span> <span class="o">=</span> <span class="n">DynamicBayesianNetworkLoader</span><span class="o">.</span><span class="na">loadFromFile</span><span class="o">(</span><span class="s">&quot;networks/simulated/exampleDBN.dbn&quot;</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dbn</span><span class="o">);</span>

        <span class="c1">//Testing dataset</span>
        <span class="n">String</span> <span class="n">filenamePredict</span> <span class="o">=</span> <span class="s">&quot;datasets/simulated/cajamar.arff&quot;</span><span class="o">;</span>
        <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">DynamicDataInstance</span><span class="o">&gt;</span> <span class="n">dataPredict</span> <span class="o">=</span> <span class="n">DynamicDataStreamLoader</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">filenamePredict</span><span class="o">);</span>

        <span class="c1">//Select the inference algorithm</span>
        <span class="n">InferenceAlgorithmForDBN</span> <span class="n">infer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FactoredFrontierForDBN</span><span class="o">(</span><span class="k">new</span> <span class="n">ImportanceSampling</span><span class="o">());</span> <span class="c1">// new ImportanceSampling(),  new VMP(),</span>
        <span class="n">infer</span><span class="o">.</span><span class="na">setModel</span><span class="o">(</span><span class="n">dbn</span><span class="o">);</span>


        <span class="n">Variable</span> <span class="n">varTarget</span> <span class="o">=</span> <span class="n">dbn</span><span class="o">.</span><span class="na">getDynamicVariables</span><span class="o">().</span><span class="na">getVariableByName</span><span class="o">(</span><span class="s">&quot;discreteHiddenVar&quot;</span><span class="o">);</span>
        <span class="n">UnivariateDistribution</span> <span class="n">posterior</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="c1">//Classify each instance</span>
        <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">DynamicDataInstance</span> <span class="n">instance</span> <span class="o">:</span> <span class="n">dataPredict</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">instance</span><span class="o">.</span><span class="na">getSequenceID</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)</span>
                <span class="k">break</span><span class="o">;</span>

            <span class="n">infer</span><span class="o">.</span><span class="na">addDynamicEvidence</span><span class="o">(</span><span class="n">instance</span><span class="o">);</span>
            <span class="n">infer</span><span class="o">.</span><span class="na">runInference</span><span class="o">();</span>

            <span class="n">posterior</span> <span class="o">=</span> <span class="n">infer</span><span class="o">.</span><span class="na">getFilteredPosterior</span><span class="o">(</span><span class="n">varTarget</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;t=&quot;</span><span class="o">+</span><span class="n">t</span><span class="o">+</span><span class="s">&quot;, P(discreteHiddenVar | Evidence)  = &quot;</span> <span class="o">+</span> <span class="n">posterior</span><span class="o">);</span>

            <span class="n">posterior</span> <span class="o">=</span> <span class="n">infer</span><span class="o">.</span><span class="na">getPredictivePosterior</span><span class="o">(</span><span class="n">varTarget</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
            <span class="c1">//Display the output</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;t=&quot;</span><span class="o">+</span><span class="n">t</span><span class="o">+</span><span class="s">&quot;+5, P(discreteHiddenVar | Evidence)  = &quot;</span> <span class="o">+</span> <span class="n">posterior</span><span class="o">);</span>


            <span class="n">t</span><span class="o">++;</span>
        <span class="o">}</span>





    <span class="o">}</span>


<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/amidst/tutorial/blob/master/src/main/java/eu/amidst/tutorial/usingAmidst/examples/DynamicModelInference.java">See on
GitHub</a></p>
<p>Note that the inference algorithm can be easily change if line 33 is
modified by replacing it with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">InferenceAlgorithmForDBN</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FactoredFrontierForDBN</span><span class="p">(</span><span class="n">new</span> <span class="n">VMP</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-dynamic-model">
<span id="sec-lvmodels-dynamic-custom"></span><h3>Custom dynamic model<a class="headerlink" href="#custom-dynamic-model" title="Permalink to this headline">¶</a></h3>
<p>Like for static models, we might be interested in creating our own
dynamic models. In this case, you will have to create a class inheriting
<em>DynamicModel</em>. Here below an example of a custom <em>Kalman Filter</em> is
given.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">eu.amidst.tutorial.usingAmidst.practice</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">COM.hugin.HAPI.ExceptionHugin</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.Attributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.DataInstance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.datastream.DataStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.io.DataStreamLoader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.models.BayesianNetwork</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.core.variables.Variable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.datastream.DynamicDataInstance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.io.DynamicBayesianNetworkWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.io.DynamicDataStreamLoader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.models.DynamicBayesianNetwork</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.models.DynamicDAG</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.dynamic.variables.DynamicVariables</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.dynamicmodels.DynamicModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.dynamicmodels.HiddenMarkovModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.dynamicmodels.KalmanFilter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.FactorAnalysis</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">eu.amidst.latentvariablemodels.staticmodels.exceptions.WrongConfigurationException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by rcabanas on 23/05/16.</span>
<span class="cm"> */</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomKalmanFilter</span> <span class="kd">extends</span> <span class="n">DynamicModel</span> <span class="o">{</span>

    <span class="n">Attributes</span> <span class="n">attributes</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CustomKalmanFilter</span><span class="o">(</span><span class="n">Attributes</span> <span class="n">attributes</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">WrongConfigurationException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">buildDAG</span><span class="o">()</span> <span class="o">{</span>

        <span class="cm">/*number of continuous hidden variable*/</span>
        <span class="kt">int</span> <span class="n">numHiddenVars</span><span class="o">=</span><span class="mi">3</span><span class="o">;</span>

        <span class="cm">/** Create a set of dynamic variables from the given attributes**/</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DynamicVariables</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>

        <span class="cm">/* List of continuous hidden vars*/</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Variable</span><span class="o">&gt;</span> <span class="n">gaussianHiddenVars</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">numHiddenVars</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Variable</span> <span class="n">Hi</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="na">newGaussianDynamicVariable</span><span class="o">(</span><span class="s">&quot;gaussianHiddenVar&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
            <span class="n">gaussianHiddenVars</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Hi</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">DynamicDAG</span> <span class="n">dynamicDAG</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DynamicDAG</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">variables</span><span class="o">);</span>


        <span class="k">for</span> <span class="o">(</span><span class="n">Variable</span> <span class="n">h</span> <span class="o">:</span> <span class="n">gaussianHiddenVars</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">dynamicDAG</span><span class="o">.</span><span class="na">getParentSetTimeT</span><span class="o">(</span><span class="n">h</span><span class="o">).</span><span class="na">addParent</span><span class="o">(</span><span class="n">h</span><span class="o">.</span><span class="na">getInterfaceVariable</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">Variable</span> <span class="n">variable</span><span class="o">:</span> <span class="n">variables</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">gaussianHiddenVars</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">variable</span><span class="o">))</span>
                <span class="k">continue</span><span class="o">;</span>

            <span class="k">for</span> <span class="o">(</span><span class="n">Variable</span> <span class="n">h</span> <span class="o">:</span> <span class="n">gaussianHiddenVars</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">dynamicDAG</span><span class="o">.</span><span class="na">getParentSetTimeT</span><span class="o">(</span><span class="n">variable</span><span class="o">).</span><span class="na">addParent</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">//This is needed to maintain coherence in the DynamicModel class.</span>
        <span class="k">this</span><span class="o">.</span><span class="na">variables</span> <span class="o">=</span> <span class="n">variables</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dynamicDAG</span> <span class="o">=</span> <span class="n">dynamicDAG</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ExceptionHugin</span> <span class="o">{</span>

        <span class="c1">//Load the datastream</span>
        <span class="n">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;datasets/simulated/cajamar.arff&quot;</span><span class="o">;</span>
        <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">DynamicDataInstance</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">DynamicDataStreamLoader</span><span class="o">.</span><span class="na">loadFromFile</span><span class="o">(</span><span class="n">filename</span><span class="o">);</span>


        <span class="c1">//Learn the model</span>
        <span class="n">DynamicModel</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CustomKalmanFilter</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">updateModel</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="n">DynamicBayesianNetwork</span> <span class="n">dbn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">getModel</span><span class="o">();</span>


        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dbn</span><span class="o">);</span>

    <span class="o">}</span>


<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/amidst/tutorial/blob/master/src/main/java/eu/amidst/tutorial/usingAmidst/practice/CustomKalmanFilter.java">See on
GitHub</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="flinklink.html" class="btn btn-neutral float-right" title="Flinklink: Code Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="wekalink.html" class="btn btn-neutral" title="Wekalink: using an AMIDST classifier in Weka" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Andrés R. Masegosa, Rafael Cabañas

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>